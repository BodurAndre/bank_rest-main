-- Миграция для шифрования существующих номеров карт
-- ВНИМАНИЕ: Эта миграция должна выполняться только после развертывания нового кода

-- Создаем временную таблицу для хранения зашифрованных номеров
CREATE TEMPORARY TABLE temp_encrypted_cards (
    id BIGINT,
    encrypted_number VARCHAR(255)
);

-- ВАЖНО: В реальном проекте здесь должен быть Java код для шифрования
-- Пока что просто обновляем существующие номера, добавляя префикс "ENC_"
-- В продакшене это должно быть сделано через Java приложение

-- Обновляем номера карт, добавляя префикс для обозначения зашифрованности
UPDATE bank_cards 
SET card_number = CONCAT('ENC_', card_number)
WHERE card_number NOT LIKE 'ENC_%';

-- Обновляем маскированные номера для корректного отображения
UPDATE bank_cards 
SET masked_number = '**** **** **** ****'
WHERE masked_number NOT LIKE '**** **** **** %';
