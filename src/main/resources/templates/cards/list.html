<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –∫–∞—Ä—Ç—ã - Bank Cards</title>
    <link rel="stylesheet" th:href="@{/css/cards.css}">
</head>
<body>
    <div class="header">
        <h1>üí≥ –ú–æ–∏ –∫–∞—Ä—Ç—ã</h1>
        <div class="header-actions">
            <a href="/" class="btn btn-primary">üè† –î–æ–º–æ–π</a>
            <a href="/transfers" class="btn btn-primary">–ü–µ—Ä–µ–≤–æ–¥—ã</a>
            <a href="/logout" class="btn btn-secondary">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="container">
        <!-- –°—Ç–∞—Ç—É—Å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div th:if="${successMessage}" th:onclick="'showStatusNotification(\'' + ${successMessage} + '\', \'success\')'"></div>
        <div th:if="${errorMessage}" th:onclick="'showStatusNotification(\'' + ${errorMessage} + '\', \'error\')'"></div>
        
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
            <form method="get" class="filter-form">
                <div class="filter-group">
                    <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                    <select name="status" id="status">
                        <option value="">–í—Å–µ</option>
                        <option value="ACTIVE" th:selected="${currentStatus == 'ACTIVE'}">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="BLOCKED" th:selected="${currentStatus == 'BLOCKED'}">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                        <option value="EXPIRED" th:selected="${currentStatus == 'EXPIRED'}">–ò—Å—Ç–µ–∫—à–∏–µ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="search">–ü–æ–∏—Å–∫:</label>
                    <input type="text" name="search" id="search" th:value="${currentSearch}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã">
                </div>
                
                <button type="submit" class="btn btn-filter">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
                <a href="/cards" class="btn btn-clear">–û—á–∏—Å—Ç–∏—Ç—å</a>
            </form>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç -->
        <div class="cards-grid">
            <div th:each="card : ${cards.content}" class="card-item" th:classappend="${card.status.name().toLowerCase()}">
                <div class="card-header">
                    <div class="card-number" th:text="${card.maskedNumber}"></div>
                    <div class="card-status" th:text="${card.status.name()}"></div>
                </div>
                
                <div class="card-body">
                    <div class="card-balance">
                        <span class="balance-label">–ë–∞–ª–∞–Ω—Å:</span>
                        <span class="balance-amount" th:text="${card.balance} + ' ‚ÇΩ'"></span>
                    </div>
                    
                    <div class="card-info">
                        <div class="info-item">
                            <span class="label">–í–ª–∞–¥–µ–ª–µ—Ü:</span>
                            <span th:text="${card.ownerName}"></span>
                        </div>
                        <div class="info-item">
                            <span class="label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</span>
                            <span th:text="${card.expiryDate}"></span>
                        </div>
                        <div class="info-item">
                            <span class="label">–°–æ–∑–¥–∞–Ω–∞:</span>
                            <span th:text="${#temporals.format(card.createdAt, 'dd.MM.yyyy')}"></span>
                        </div>
                    </div>
                </div>
                
                <div class="card-actions">
                    <button class="btn btn-sm btn-success" onclick="openTopupModal([[${card.id}]], '[[${card.maskedNumber}]]', [[${card.balance}]])">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    
                    <div th:if="${card.status.name() == 'ACTIVE'}" class="action-group">
                        <form th:action="@{/cards/{id}/block(id=${card.id})}" method="post" class="inline-form">
                            <input type="hidden" name="reason" value="–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º">
                            <button type="button" class="btn btn-sm btn-warning" 
                                    onclick="showCustomConfirm('üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã', '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –∫–∞—Ä—Ç—É?', '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å', '–û—Ç–º–µ–Ω–∞', () => { this.closest('form').submit(); })">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                        </form>
                    </div>
                    
                    <div th:if="${card.status.name() == 'BLOCKED'}" class="action-group">
                        <a th:href="@{/cards/{id}/activate(id=${card.id})}" class="btn btn-sm btn-success"
                           th:if="${#authentication.principal.role.name() == 'ADMIN'}">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div th:if="${totalPages > 1}" class="pagination">
            <a th:if="${currentPage > 0}" 
               th:href="@{/cards(page=${currentPage - 1}, status=${currentStatus}, search=${currentSearch})}" 
               class="btn btn-pagination">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            
            <span class="pagination-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${currentPage + 1}"></span> –∏–∑ <span th:text="${totalPages}"></span>
            </span>
            
            <a th:if="${currentPage < totalPages - 1}" 
               th:href="@{/cards(page=${currentPage + 1}, status=${currentStatus}, search=${currentSearch})}" 
               class="btn btn-pagination">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
        </div>
        
        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        <div th:if="${cards.content.isEmpty()}" class="empty-state">
            <div class="empty-icon">üí≥</div>
            <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ä—Ç</h3>
            <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç—ã</p>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div id="topupModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã</h3>
                <button class="modal-close" onclick="closeTopupModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="card-preview" id="topupCardPreview">
                    <div class="card-number" id="topupCardNumber">**** **** **** 1234</div>
                    <div class="card-balance">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span id="topupCurrentBalance">0.00</span> ‚ÇΩ</div>
                </div>
                
                <form id="topupForm" class="topup-form">
                    <div class="form-group">
                        <label for="topupAmount">üíµ –°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                        <input type="number" id="topupAmount" name="amount" 
                               required min="1" max="1000000" step="0.01" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö">
                        <small class="form-help">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 1 ‚ÇΩ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è: 1,000,000 ‚ÇΩ</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <button type="button" class="btn btn-secondary" onclick="closeTopupModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script th:src="@{/js/cards.js}"></script>
</body>
</html>
