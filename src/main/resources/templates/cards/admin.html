<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Å–µ –∫–∞—Ä—Ç—ã - Bank Cards</title>
    <link rel="stylesheet" th:href="@{/css/cards.css}">
</head>
<body>
    <div class="header">
        <h1>üëë –í—Å–µ –∫–∞—Ä—Ç—ã (–ê–¥–º–∏–Ω)</h1>
        <div class="header-actions">
            <a href="/" class="btn btn-primary">üè† –î–æ–º–æ–π</a>
            <a href="/cards/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É</a>
            <a href="/logout" class="btn btn-secondary">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="container">
        <!-- –°—Ç–∞—Ç—É—Å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div th:if="${successMessage}" class="status-notification" th:data-message="${successMessage}" data-type="success"></div>
        <div th:if="${errorMessage}" class="status-notification" th:data-message="${errorMessage}" data-type="error"></div>
        
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
            <form method="get" class="filter-form">
                <div class="filter-group">
                    <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                    <select name="status" id="status">
                        <option value="">–í—Å–µ</option>
                        <option value="ACTIVE" th:selected="${currentStatus == 'ACTIVE'}">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="BLOCKED" th:selected="${currentStatus == 'BLOCKED'}">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
                        <option value="EXPIRED" th:selected="${currentStatus == 'EXPIRED'}">–ò—Å—Ç–µ–∫—à–∏–µ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="search">–ü–æ–∏—Å–∫:</label>
                    <input type="text" name="search" id="search" th:value="${currentSearch}" 
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã –∏–ª–∏ email">
                </div>
                
                <button type="submit" class="btn btn-filter">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
                <a href="/cards/admin" class="btn btn-clear">–û—á–∏—Å—Ç–∏—Ç—å</a>
            </form>
            
            <!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
            <div class="export-section">
                <button type="button" class="btn btn-export" onclick="showExportModal('cards')">üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
            </div>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç -->
        <div class="cards-grid">
            <div th:each="card : ${cards.content}" class="card-item admin-card" th:classappend="${card.status.name().toLowerCase()}">
                <div class="card-header">
                    <div class="card-number" th:text="${card.maskedNumber}"></div>
                    <div class="card-status" th:text="${card.status.name()}"></div>
                </div>
                
                <div class="card-body">
                    <div class="card-balance">
                        <span class="balance-label">–ë–∞–ª–∞–Ω—Å:</span>
                        <span class="balance-amount" th:text="${card.balance} + ' ‚ÇΩ'"></span>
                    </div>
                    
                    <div class="card-info">
                        <div class="info-item">
                            <span class="label">–í–ª–∞–¥–µ–ª–µ—Ü:</span>
                            <span th:text="${card.ownerName}"></span>
                        </div>
                        <div class="info-item">
                            <span class="label">Email:</span>
                            <span th:text="${card.ownerEmail}"></span>
                        </div>
                        <div class="info-item">
                            <span class="label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</span>
                            <span th:text="${card.expiryDate}"></span>
                        </div>
                        <div class="info-item">
                            <span class="label">–°–æ–∑–¥–∞–Ω–∞:</span>
                            <span th:text="${#temporals.format(card.createdAt, 'dd.MM.yyyy')}"></span>
                        </div>
                    </div>
                </div>
                
                <div class="card-actions admin-actions">
                    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ -->
                    <div class="hidden-card-data" style="display: none;">
                        <span class="card-id" th:text="${card.id}"></span>
                        <span class="card-number" th:text="${card.maskedNumber}"></span>
                        <span class="card-balance" th:text="${card.balance}"></span>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç -->
                    <div th:if="${card.status.name() == 'ACTIVE'}" class="action-group">
                        <button class="btn btn-sm btn-success topup-btn" 
                                th:data-card-id="${card.id}" 
                                th:data-card-number="${card.maskedNumber}" 
                                th:data-card-balance="${card.balance}">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn-sm btn-warning block-btn" 
                                th:data-card-id="${card.id}"
                                th:data-reason="'–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º'">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç -->
                    <div th:if="${card.status.name() == 'BLOCKED'}" class="action-group">
                        <button type="button" class="btn btn-sm btn-success activate-btn" 
                                th:data-card-id="${card.id}">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö –∫–∞—Ä—Ç -->
                    <div th:if="${card.status.name() == 'EXPIRED'}" class="action-group">
                        <button type="button" class="btn btn-sm btn-warning admin-recreate-card-btn" 
                                th:data-card-id="${card.id}" 
                                th:data-card-number="${card.maskedNumber}"
                                th:data-owner-email="${card.ownerEmail}">üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É</button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç -->
                    <div class="action-group">
                        <button type="button" class="btn btn-sm btn-danger delete-btn" 
                                th:data-card-id="${card.id}">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div th:if="${totalPages > 1}" class="pagination">
            <a th:if="${currentPage > 0}" 
               th:href="@{/cards/admin(page=${currentPage - 1}, status=${currentStatus}, search=${currentSearch})}" 
               class="btn btn-pagination">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            
            <span class="pagination-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${currentPage + 1}"></span> –∏–∑ <span th:text="${totalPages}"></span>
            </span>
            
            <a th:if="${currentPage < totalPages - 1}" 
               th:href="@{/cards/admin(page=${currentPage + 1}, status=${currentStatus}, search=${currentSearch})}" 
               class="btn btn-pagination">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
        </div>
        
        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        <div th:if="${cards.content.isEmpty()}" class="empty-state">
            <div class="empty-icon">üí≥</div>
            <h3>–ö–∞—Ä—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É</p>
            <a href="/cards/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É</a>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div id="topupModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã</h3>
                <button class="modal-close" onclick="closeTopupModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="card-preview" id="topupCardPreview">
                    <div class="card-number" id="topupCardNumber">**** **** **** 1234</div>
                    <div class="card-balance">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span id="topupCurrentBalance">0.00</span> ‚ÇΩ</div>
                </div>
                
                <form id="topupForm" class="topup-form">
                    <div class="form-group">
                        <label for="topupAmount">üíµ –°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
                        <input type="number" id="topupAmount" name="amount" 
                               required min="1" max="1000000" step="0.01" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö">
                        <small class="form-help">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 1 ‚ÇΩ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è: 1,000,000 ‚ÇΩ</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <button type="button" class="btn btn-secondary" onclick="closeTopupModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script th:src="@{/js/cards.js}"></script>
    <script th:src="@{/js/card-actions.js}"></script>
    <script th:src="@{/js/admin-card-recreate.js}"></script>
    
    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            const successNotification = document.querySelector('.status-notification[data-type="success"]');
            const errorNotification = document.querySelector('.status-notification[data-type="error"]');
            
            if (successNotification) {
                const message = successNotification.getAttribute('data-message');
                showStatusNotification(message, 'success');
            }
            
            if (errorNotification) {
                const message = errorNotification.getAttribute('data-message');
                showStatusNotification(message, 'error');
            }
        });
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JavaScript –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <script th:src="@{/js/admin-export.js}"></script>
</body>
</html>
