package com.example.bankcards.util;

import com.example.bankcards.exception.ValidationException;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.junit.jupiter.MockitoExtension;

import java.math.BigDecimal;
import java.time.LocalDate;

import static org.junit.jupiter.api.Assertions.*;

/**
 * –¢–µ—Å—Ç—ã –¥–ª—è ValidationUtils
 */
@ExtendWith(MockitoExtension.class)
class ValidationUtilsTest {

    @InjectMocks
    private ValidationUtils validationUtils;

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ email")
    void validateEmail_ValidEmail() {
        // Given
        String validEmail = "test@example.com";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateEmail(validEmail));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è email —Å –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏")
    void validateEmail_ValidEmailWithSubdomains() {
        // Given
        String validEmail = "user@mail.example.com";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateEmail(validEmail));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è email —Å —Ü–∏—Ñ—Ä–∞–º–∏")
    void validateEmail_ValidEmailWithNumbers() {
        // Given
        String validEmail = "user123@example.com";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateEmail(validEmail));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ email")
    void validateEmail_InvalidEmail() {
        // Given
        String invalidEmail = "invalid-email";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateEmail(invalidEmail));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ email")
    void validateEmail_EmptyEmail() {
        // Given
        String emptyEmail = "";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateEmail(emptyEmail));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è null email")
    void validateEmail_NullEmail() {
        // Given
        String nullEmail = null;

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateEmail(nullEmail));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è email –±–µ–∑ @")
    void validateEmail_EmailWithoutAt() {
        // Given
        String emailWithoutAt = "userexample.com";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateEmail(emailWithoutAt));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è email —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ @")
    void validateEmail_EmailWithMultipleAt() {
        // Given
        String emailWithMultipleAt = "user@example@com";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateEmail(emailWithMultipleAt));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ ID")
    void validateId_ValidId() {
        // Given
        Long validId = 1L;

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateId(validId, "–∫–∞—Ä—Ç—ã"));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω—É–ª–µ–≤–æ–≥–æ ID")
    void validateId_ZeroId() {
        // Given
        Long zeroId = 0L;

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateId(zeroId, "–∫–∞—Ä—Ç—ã"));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ ID")
    void validateId_NegativeId() {
        // Given
        Long negativeId = -1L;

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateId(negativeId, "–∫–∞—Ä—Ç—ã"));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è null ID")
    void validateId_NullId() {
        // Given
        Long nullId = null;

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateId(nullId, "–∫–∞—Ä—Ç—ã"));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—É–º–º—ã")
    void validateMinAmount_ValidAmount() {
        // Given
        BigDecimal validAmount = BigDecimal.valueOf(100.50);
        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateMinAmount(validAmount, minAmount));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã")
    void validateMinAmount_MinimumAmount() {
        // Given
        BigDecimal minimumAmount = BigDecimal.valueOf(0.01);
        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateMinAmount(minimumAmount, minAmount));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω—É–ª–µ–≤–æ–π —Å—É–º–º—ã")
    void validateMinAmount_ZeroAmount() {
        // Given
        BigDecimal zeroAmount = BigDecimal.ZERO;
        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateMinAmount(zeroAmount, minAmount));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º—ã")
    void validateMinAmount_NegativeAmount() {
        // Given
        BigDecimal negativeAmount = BigDecimal.valueOf(-100.00);
        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateMinAmount(negativeAmount, minAmount));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è null —Å—É–º–º—ã")
    void validateMinAmount_NullAmount() {
        // Given
        BigDecimal nullAmount = null;
        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateMinAmount(nullAmount, minAmount));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π")
    void validateMinAmount_AmountLessThanMinimum() {
        // Given
        BigDecimal smallAmount = BigDecimal.valueOf(0.005);
        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateMinAmount(smallAmount, minAmount));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è")
    void validateDescription_ValidDescription() {
        // Given
        String validDescription = "Valid description";
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateDescription(validDescription, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è —Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏")
    void validateDescription_DescriptionWithSpecialChars() {
        // Given
        String descriptionWithSpecialChars = "Description with special chars: !@#$%^&*()";
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateDescription(descriptionWithSpecialChars, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è —Å —ç–º–æ–¥–∑–∏")
    void validateDescription_DescriptionWithEmoji() {
        // Given
        String descriptionWithEmoji = "Description with emoji üè¶üí∞";
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateDescription(descriptionWithEmoji, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è")
    void validateDescription_EmptyDescription() {
        // Given
        String emptyDescription = "";
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateDescription(emptyDescription, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è null –æ–ø–∏—Å–∞–Ω–∏—è")
    void validateDescription_NullDescription() {
        // Given
        String nullDescription = null;
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateDescription(nullDescription, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–±–µ–ª–æ–≤")
    void validateDescription_WhitespaceOnlyDescription() {
        // Given
        String whitespaceOnlyDescription = "   ";
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateDescription(whitespaceOnlyDescription, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è")
    void validateDescription_TooLongDescription() {
        // Given
        String tooLongDescription = "a".repeat(1001); // Exceeds maximum length
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateDescription(tooLongDescription, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã")
    void validateDescription_MaximumLengthDescription() {
        // Given
        String maximumLengthDescription = "a".repeat(1000); // Maximum allowed length
        String fieldName = "–û–ø–∏—Å–∞–Ω–∏–µ";

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateDescription(maximumLengthDescription, fieldName));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è")
    void validateExpiryDate_ValidExpiryDate() {
        // Given
        LocalDate validExpiryDate = LocalDate.now().plusYears(2);

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateExpiryDate(validExpiryDate));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –ø—Ä–æ—à–ª–æ–º")
    void validateExpiryDate_PastExpiryDate() {
        // Given
        LocalDate pastExpiryDate = LocalDate.now().minusDays(1);

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateExpiryDate(pastExpiryDate));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è null –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è")
    void validateExpiryDate_NullExpiryDate() {
        // Given
        LocalDate nullExpiryDate = null;

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateExpiryDate(nullExpiryDate));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è")
    void validateExpiryDate_TodayExpiryDate() {
        // Given
        LocalDate todayExpiryDate = LocalDate.now();

        // When & Then
        assertThrows(ValidationException.class, () -> validationUtils.validateExpiryDate(todayExpiryDate));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è –∑–∞–≤—Ç—Ä–∞")
    void validateExpiryDate_TomorrowExpiryDate() {
        // Given
        LocalDate tomorrowExpiryDate = LocalDate.now().plusDays(1);

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateExpiryDate(tomorrowExpiryDate));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –¥–∞–ª–µ–∫–æ–º –±—É–¥—É—â–µ–º")
    void validateExpiryDate_FarFutureExpiryDate() {
        // Given
        LocalDate farFutureExpiryDate = LocalDate.now().plusYears(10);

        // When & Then
        assertDoesNotThrow(() -> validationUtils.validateExpiryDate(farFutureExpiryDate));
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –¥–ª—è email")
    void validateEmail_EdgeCases() {
        // Test various edge cases
        String[] validEmails = {
            "a@b.co",
            "test+tag@example.com",
            "test.email@example.com",
            "test_email@example.com",
            "123@example.com"
        };

        String[] invalidEmails = {
            "@example.com",
            "test@",
            "test@.com",
            "test..email@example.com",
            "test@example..com",
            "test@example.com.",
            "test@example.com.."
        };

        for (String email : validEmails) {
            assertDoesNotThrow(() -> validationUtils.validateEmail(email), 
                "Email should be valid: " + email);
        }

        for (String email : invalidEmails) {
            assertThrows(ValidationException.class, () -> validationUtils.validateEmail(email), 
                "Email should be invalid: " + email);
        }
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –¥–ª—è —Å—É–º–º—ã")
    void validateMinAmount_EdgeCases() {
        // Test various edge cases
        BigDecimal[] validAmounts = {
            BigDecimal.valueOf(0.01),
            BigDecimal.valueOf(0.1),
            BigDecimal.valueOf(1.0),
            BigDecimal.valueOf(100.0),
            BigDecimal.valueOf(999999.99)
        };

        BigDecimal[] invalidAmounts = {
            BigDecimal.valueOf(0.001),
            BigDecimal.valueOf(0.009),
            BigDecimal.valueOf(-0.01),
            BigDecimal.valueOf(-100.0)
        };

        BigDecimal minAmount = BigDecimal.valueOf(0.01);

        for (BigDecimal amount : validAmounts) {
            assertDoesNotThrow(() -> validationUtils.validateMinAmount(amount, minAmount), 
                "Amount should be valid: " + amount);
        }

        for (BigDecimal amount : invalidAmounts) {
            assertThrows(ValidationException.class, () -> validationUtils.validateMinAmount(amount, minAmount), 
                "Amount should be invalid: " + amount);
        }
    }

    @Test
    @DisplayName("–í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –¥–ª—è ID")
    void validateId_EdgeCases() {
        // Test various edge cases
        Long[] validIds = {
            1L,
            100L,
            999999L,
            Long.MAX_VALUE
        };

        Long[] invalidIds = {
            0L,
            -1L,
            -100L,
            Long.MIN_VALUE
        };

        for (Long id : validIds) {
            assertDoesNotThrow(() -> validationUtils.validateId(id, "–∫–∞—Ä—Ç—ã"), 
                "ID should be valid: " + id);
        }

        for (Long id : invalidIds) {
            assertThrows(ValidationException.class, () -> validationUtils.validateId(id, "–∫–∞—Ä—Ç—ã"), 
                "ID should be invalid: " + id);
        }
    }
}